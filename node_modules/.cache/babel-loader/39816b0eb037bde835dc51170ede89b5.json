{"ast":null,"code":"import _asyncToGenerator from\"C:\\\\Users\\\\Abhishek\\\\Desktop\\\\E-Commerce\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"C:\\\\Users\\\\Abhishek\\\\Desktop\\\\E-Commerce\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\Abhishek\\\\Desktop\\\\E-Commerce\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect}from\"react\";import Loader from\"../components/loader\";import{Form,Button,Row,Card,Image,Col,ListGroup,ListGroupItem}from\"react-bootstrap\";import{PayPalButton}from\"react-paypal-button-v2\";import{useDispatch,useSelector}from\"react-redux\";import{getOrderDetails,payOrder,deliverOrder}from\"../Actions/orderAction\";import{Link,useParams}from\"react-router-dom\";import Message from\"../components/message\";import axios from\"axios\";import{useNavigate}from\"react-router\";import{ORDER_PAY_RESET,ORDER_DELIVER_RESET}from\"../Constants/orderConstants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var OrderScreen=function OrderScreen(){var _useParams=useParams(),orderId=_useParams.id;var dispatch=useDispatch();var navigate=useNavigate();var orderDetails=useSelector(function(state){return state.orderDetails;});var error=orderDetails.error,loading=orderDetails.loading,order=orderDetails.order;var orderPay=useSelector(function(state){return state.orderPay;});var loadingPay=orderPay.loading,successPay=orderPay.success;var orderDeliver=useSelector(function(state){return state.orderDeliver;});var loadingDeliver=orderDeliver.loading,successDeliver=orderDeliver.success;var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),sdkReady=_useState2[0],setSdkReady=_useState2[1];useEffect(function(){if(!userInfo){navigate(\"/login\");}var addPayPalScript=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,clientId,script;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/Api/config/paypal');case 2:_yield$axios$get=_context.sent;clientId=_yield$axios$get.data;script=document.createElement('script');script.type='text/javascript';script.src=\"https://www.paypal.com/sdk/js?client-id=\".concat(clientId);script.async=true;script.onload=function(){setSdkReady(true);};document.body.appendChild(script);case 10:case\"end\":return _context.stop();}}},_callee);}));return function addPayPalScript(){return _ref.apply(this,arguments);};}();if(!order||successPay||successDeliver){dispatch({type:ORDER_PAY_RESET});dispatch({type:ORDER_DELIVER_RESET});dispatch(getOrderDetails(orderId));}else if(!order.isPaid){if(!window.paypal){addPayPalScript();}else{setSdkReady(true);}}},[dispatch,orderId,successPay,order,successDeliver,navigate,userInfo]);// console.log(order);\nvar successPaymentHandler=function successPaymentHandler(paymentResult){console.log(paymentResult);dispatch(payOrder(orderId,paymentResult));};var razorPayHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(amt){var raz_paymentId,raz_orderId,raz_signature,script,razdata,options,rzp1,config,resData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:raz_paymentId='';raz_orderId='';raz_signature='';script=document.createElement('script');script.type='text/javascript';script.src=\"https://checkout.razorpay.com/v1/checkout.js\";script.async=true;document.body.appendChild(script);_context2.next=10;return axios.post('/Api/config/razorpay');case 10:razdata=_context2.sent;console.log(razdata);options={\"key\":'rzp_test_NENjtw57a4vV8I',\"amount\":amt*100,\"currency\":\"INR\",\"name\":\"Buy-Easy Inc.\",\"description\":\"At Buy-Easy we ensure your safety over any thing\",\"image\":\"/android-chrome-192x192.png\",\"order_id\":\"\".concat(razdata.data.id),\"handler\":function async(response){raz_paymentId=response.razorpay_payment_id;raz_orderId=response.razorpay_order_id;raz_signature=response.razorpay_signature;},\"theme\":{\"color\":\"#3399cc\"}};rzp1=new window.Razorpay(options);rzp1.open();// e.preventDefault();\nconfig={headers:{'Content-Type':'application/json'}};// actual data is not posting\n_context2.next=18;return axios.put(\"/Api/razorpay/\".concat(orderId,\"/details\"),{raz_paymentId:raz_paymentId,raz_orderId:raz_orderId,raz_signature:raz_signature},config);case 18:resData=_context2.sent;case 19:case\"end\":return _context2.stop();}}},_callee2);}));return function razorPayHandler(_x){return _ref2.apply(this,arguments);};}();var deliverHandler=function deliverHandler(){dispatch(deliverOrder(order));};return loading?/*#__PURE__*/_jsx(Loader,{}):error?/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:error}):/*#__PURE__*/_jsx(_Fragment,{children:order!==undefined&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Order Id\"}),\" \",/*#__PURE__*/_jsx(\"u\",{children:/*#__PURE__*/_jsx(\"h5\",{children:order._id})}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:8,children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Shipping Details\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name :\"}),order.user.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[\" \",/*#__PURE__*/_jsx(\"strong\",{children:\"Email :\"}),/*#__PURE__*/_jsx(\"a\",{href:\"mailto:\".concat(order.user.email),children:order.user.email})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Address: \"}),order.shippingAddress.address,\",\",order.shippingAddress.city,\" \",order.shippingAddress.postalCode,\" \",order.shippingAddress.country]}),order.isDelivered?/*#__PURE__*/_jsxs(Message,{variant:\"success\",children:[\"Delivered On \",order.deliveredAt]}):/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:\"Not Delivered\"})]}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Payment Method\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"METHOD:\"}),order.paymentMethod]}),order.isPaid?/*#__PURE__*/_jsxs(Message,{variant:\"success\",children:[\"Paid On \",order.paidAt.substring(0,10)]}):/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:\"Not Paid\"})]}),/*#__PURE__*/_jsxs(ListGroupItem,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Order Items\"}),order.orderItems.length===0?/*#__PURE__*/_jsx(Message,{children:\"Order is Empty\"}):/*#__PURE__*/_jsx(ListGroupItem,{variant:\"flush\",children:order.orderItems.map(function(item,index){return/*#__PURE__*/_jsx(ListGroupItem,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:1,children:/*#__PURE__*/_jsx(Image,{src:item.image,alt:item.name,fluid:true,rounded:true})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(item._id),children:item.name})}),/*#__PURE__*/_jsxs(Col,{md:4,children:[item.qty,\" x \\u20B9\",item.price,\"= \\u20B9\",\" \",item.qty*item.price]})]})},index);})})]})]})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsx(ListGroupItem,{children:/*#__PURE__*/_jsx(\"h2\",{children:\"Order Summary\"})}),/*#__PURE__*/_jsx(ListGroupItem,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Items\"}),/*#__PURE__*/_jsxs(Col,{children:[\"\\u20B9\",order.itemsPrice]})]})}),/*#__PURE__*/_jsx(ListGroupItem,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Shipping\"}),/*#__PURE__*/_jsxs(Col,{children:[\"\\u20B9\",order.shippingPrice]})]})}),/*#__PURE__*/_jsx(ListGroupItem,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Taxes\"}),/*#__PURE__*/_jsxs(Col,{children:[\"\\u20B9\",order.taxPrice]})]})}),/*#__PURE__*/_jsx(ListGroupItem,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Total Price\"}),/*#__PURE__*/_jsxs(Col,{children:[\"\\u20B9\",order.totalPrice]})]})}),!order.isPaid&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(ListGroupItem,{children:[loadingPay&&/*#__PURE__*/_jsx(Loader,{}),!sdkReady?/*#__PURE__*/_jsx(Loader,{}):/*#__PURE__*/_jsx(PayPalButton,{amount:order.totalPrice,onSuccess:successPaymentHandler})]}),/*#__PURE__*/_jsx(ListGroupItem,{children:/*#__PURE__*/_jsx(Button,{variant:\"dark\",type:\"button\",onClick:function onClick(){return razorPayHandler(order.totalPrice);},children:\"PAY WITH RAZORPAY\"})})]}),userInfo&&userInfo.isAdmin&&order.isPaid&&!order.isDelivered&&/*#__PURE__*/_jsx(ListGroupItem,{children:/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"dark\",className:\"btn btn-block\",onClick:deliverHandler,children:\"Mark as Delivered\"})})]})})})]})]})});};export default OrderScreen;","map":{"version":3,"sources":["C:/Users/Abhishek/Desktop/E-Commerce/frontend/src/Screens/OrderScreen.js"],"names":["React","useState","useEffect","Loader","Form","Button","Row","Card","Image","Col","ListGroup","ListGroupItem","PayPalButton","useDispatch","useSelector","getOrderDetails","payOrder","deliverOrder","Link","useParams","Message","axios","useNavigate","ORDER_PAY_RESET","ORDER_DELIVER_RESET","OrderScreen","orderId","id","dispatch","navigate","orderDetails","state","error","loading","order","orderPay","loadingPay","successPay","success","orderDeliver","loadingDeliver","successDeliver","userLogin","userInfo","sdkReady","setSdkReady","addPayPalScript","get","clientId","data","script","document","createElement","type","src","async","onload","body","appendChild","isPaid","window","paypal","successPaymentHandler","paymentResult","console","log","razorPayHandler","amt","raz_paymentId","raz_orderId","raz_signature","post","razdata","options","response","razorpay_payment_id","razorpay_order_id","razorpay_signature","rzp1","Razorpay","open","config","headers","put","resData","deliverHandler","undefined","_id","user","name","email","shippingAddress","address","city","postalCode","country","isDelivered","deliveredAt","paymentMethod","paidAt","substring","orderItems","length","map","item","index","image","qty","price","itemsPrice","shippingPrice","taxPrice","totalPrice","isAdmin"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport Loader from \"../components/loader\";\r\nimport {\r\n  Form,\r\n  Button,\r\n  Row,\r\n  Card,\r\n  Image,\r\n  Col,\r\n  ListGroup,\r\n  ListGroupItem,\r\n} from \"react-bootstrap\";\r\nimport { PayPalButton } from \"react-paypal-button-v2\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { getOrderDetails, payOrder ,deliverOrder} from \"../Actions/orderAction\";\r\nimport { Link, useParams } from \"react-router-dom\";\r\nimport Message from \"../components/message\";\r\nimport axios from \"axios\";\r\nimport { useNavigate } from \"react-router\";\r\nimport { ORDER_PAY_RESET,ORDER_DELIVER_RESET } from \"../Constants/orderConstants\";\r\n\r\nconst OrderScreen =  () => {\r\n\r\n\r\n\r\n  const { id: orderId } = useParams();\r\n  const dispatch = useDispatch();\r\n  const navigate=useNavigate()\r\n\r\n  const orderDetails = useSelector((state) => state.orderDetails);\r\n  const { error, loading, order } = orderDetails;\r\n\r\n  const orderPay = useSelector((state) => state.orderPay);\r\n  const {loading:loadingPay, success:successPay } = orderPay;\r\n\r\n  const orderDeliver = useSelector((state) => state.orderDeliver);\r\n  const {loading:loadingDeliver, success:successDeliver } = orderDeliver;\r\n\r\n  const userLogin = useSelector((state) => state.userLogin);\r\n  const { userInfo } = userLogin;\r\n\r\n   const [sdkReady,setSdkReady]=useState(false)\r\n  useEffect(() => {\r\n     if(!userInfo){\r\n       navigate(`/login`)\r\n     }\r\n\r\n    const addPayPalScript=async()=>{\r\n      const{data:clientId}=await axios.get('/Api/config/paypal')\r\n      const script=document.createElement('script')\r\n      script.type='text/javascript'\r\n      script.src=`https://www.paypal.com/sdk/js?client-id=${clientId}`\r\n      script.async=true\r\n      script.onload=()=>{\r\n        setSdkReady(true)\r\n      }\r\n     document.body.appendChild(script)\r\n\r\n    }\r\n    if(!order || successPay||successDeliver){\r\n      dispatch({type:ORDER_PAY_RESET})\r\n      dispatch({type:ORDER_DELIVER_RESET})\r\n      dispatch(getOrderDetails(orderId))\r\n    }else if(!order.isPaid) {\r\n        if(!window.paypal){\r\n          addPayPalScript()\r\n        }else{\r\n          setSdkReady(true)\r\n        }\r\n    }\r\n    }, [dispatch,orderId,successPay,order,successDeliver,navigate,userInfo]);\r\n\r\n\r\n\r\n  // console.log(order);\r\n\r\n  const successPaymentHandler=(paymentResult)=>{\r\n        console.log(paymentResult);\r\n        dispatch(payOrder(orderId,paymentResult))\r\n  }\r\n  \r\n\r\n  \r\n\r\n     const razorPayHandler=async(amt)=>{\r\n\r\n      var raz_paymentId =''\r\n      var raz_orderId=''\r\n      var raz_signature=''\r\n           \r\n      const script=document.createElement('script')\r\n      script.type='text/javascript'\r\n      script.src=`https://checkout.razorpay.com/v1/checkout.js`\r\n      script.async=true\r\n     document.body.appendChild(script)\r\n\r\n     const razdata= await axios.post('/Api/config/razorpay')\r\n          console.log(razdata)\r\n     var options = {\r\n      \"key\": 'rzp_test_NENjtw57a4vV8I', \r\n      \"amount\": amt*100, \r\n      \r\n      \"currency\": \"INR\",\r\n      \"name\": \"Buy-Easy Inc.\",\r\n      \"description\": \"At Buy-Easy we ensure your safety over any thing\",\r\n      \"image\": \"/android-chrome-192x192.png\",\r\n      \"order_id\": `${razdata.data.id}`, \r\n      \"handler\": function async(response){\r\n           raz_paymentId=response.razorpay_payment_id\r\n           raz_orderId=response.razorpay_order_id\r\n           raz_signature=response.razorpay_signature\r\n          },\r\n      \"theme\": {\r\n          \"color\": \"#3399cc\"\r\n      }\r\n  };\r\n        \r\n  var rzp1 = new window.Razorpay(options);\r\n  rzp1.open();\r\n  // e.preventDefault();\r\n  const config={\r\n    headers:{\r\n       'Content-Type':'application/json',    \r\n    },\r\n}\r\n\r\n// actual data is not posting\r\n    const resData=await axios.put(`/Api/razorpay/${orderId}/details`,{raz_paymentId,raz_orderId,raz_signature},config)\r\n  \r\n    // console.log(resData);\r\n  }\r\n     \r\n\r\n\r\n  const deliverHandler=()=>{\r\n    \r\n    dispatch(deliverOrder(order))\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n  return loading ? (\r\n    <Loader />\r\n  ) : error ? (\r\n    <Message variant=\"danger\">{error}</Message>\r\n  ) : (\r\n    <>\r\n      {order !== undefined && (\r\n        <>\r\n          <h2>Order Id</h2>{\" \"}\r\n          <u>\r\n            <h5>{order._id}</h5>\r\n          </u>\r\n          {/*❤ error can occur*/}\r\n          <Row>\r\n            <Col md={8}>\r\n              <ListGroup variant=\"flush\">\r\n                <ListGroup.Item>\r\n                  <h2>Shipping Details</h2>\r\n                  <p>\r\n                    <strong>Name :</strong>\r\n                    {order.user.name}\r\n                  </p>\r\n                  <p>\r\n                    {\" \"}\r\n                    <strong>Email :</strong>\r\n                    <a href={`mailto:${order.user.email}`}>\r\n                      {order.user.email}\r\n                    </a>\r\n                  </p>\r\n                  <p>\r\n                    <strong>Address: </strong>\r\n                    {order.shippingAddress.address},{order.shippingAddress.city}{\" \"}\r\n                    {order.shippingAddress.postalCode}{\" \"}\r\n                    {order.shippingAddress.country}\r\n                  </p>\r\n                  {order.isDelivered ? (\r\n                    <Message variant=\"success\">\r\n                      Delivered On {order.deliveredAt}\r\n                    </Message>\r\n                  ) : (\r\n                    <Message variant=\"danger\">Not Delivered</Message>\r\n                  )}\r\n                </ListGroup.Item>\r\n\r\n                <ListGroup.Item>\r\n                  <h2>Payment Method</h2>\r\n                  <p>\r\n                    <strong>METHOD:</strong>\r\n                    {order.paymentMethod}\r\n                  </p>\r\n                  {order.isPaid ? (\r\n                    <Message variant=\"success\">Paid On {order.paidAt.substring(0,10)}</Message>\r\n                  ) : (\r\n                    <Message variant=\"danger\">Not Paid</Message>\r\n                  )}\r\n                </ListGroup.Item>\r\n\r\n                <ListGroupItem>\r\n                  <h2>Order Items</h2>\r\n                  {order.orderItems.length === 0 ? (\r\n                    <Message>Order is Empty</Message>\r\n                  ) : (\r\n                    <ListGroupItem variant=\"flush\">\r\n                      {order.orderItems.map((item, index) => (\r\n                        <ListGroupItem key={index}>\r\n                          <Row>\r\n                            <Col md={1}>\r\n                              <Image\r\n                                src={item.image}\r\n                                alt={item.name}\r\n                                fluid\r\n                                rounded\r\n                              ></Image>\r\n                            </Col>\r\n                            <Col>\r\n                              <Link to={`/product/${item._id}`}>\r\n                                {item.name}\r\n                              </Link>\r\n                            </Col>\r\n                            <Col md={4}>\r\n                              {item.qty} x ₹{item.price}= ₹{\" \"}\r\n                              {item.qty * item.price}\r\n                            </Col>\r\n                          </Row>\r\n                        </ListGroupItem>\r\n                      ))}\r\n                    </ListGroupItem>\r\n                  )}\r\n                </ListGroupItem>\r\n              </ListGroup>\r\n            </Col>\r\n\r\n            <Col md={4}>\r\n              <Card>\r\n                <ListGroup variant=\"flush\">\r\n                  <ListGroupItem>\r\n                    <h2>Order Summary</h2>\r\n                  </ListGroupItem>\r\n                  <ListGroupItem>\r\n                    <Row>\r\n                      <Col>Items</Col>\r\n                      <Col>₹{order.itemsPrice}</Col>\r\n                    </Row>\r\n                  </ListGroupItem>\r\n                  <ListGroupItem>\r\n                    <Row>\r\n                      <Col>Shipping</Col>\r\n                      <Col>₹{order.shippingPrice}</Col>\r\n                    </Row>\r\n                  </ListGroupItem>\r\n                  <ListGroupItem>\r\n                    <Row>\r\n                      <Col>Taxes</Col>\r\n                      <Col>₹{order.taxPrice}</Col>\r\n                    </Row>\r\n                  </ListGroupItem>\r\n                  <ListGroupItem>\r\n                    <Row>\r\n                      <Col>Total Price</Col>\r\n                      <Col>₹{order.totalPrice}</Col>\r\n                    </Row>\r\n                  </ListGroupItem>\r\n                  {!order.isPaid &&(\r\n                    <>\r\n                    <ListGroupItem>\r\n                      {loadingPay&&<Loader/>}\r\n                      {!sdkReady?<Loader/>:(\r\n                           <PayPalButton amount={order.totalPrice} onSuccess={successPaymentHandler}/> \r\n                      )}                    \r\n                    </ListGroupItem>\r\n                     \r\n                    <ListGroupItem>\r\n                      <Button variant='dark' type='button' onClick={()=>razorPayHandler(order.totalPrice)}>PAY WITH RAZORPAY</Button>\r\n                    </ListGroupItem>\r\n                    \r\n                  \r\n                    </>\r\n            \r\n                     )}     \r\n                      {userInfo&&userInfo.isAdmin && order.isPaid && !order.isDelivered&&(\r\n                     <ListGroupItem>\r\n                       <Button type='button' variant='dark' className='btn btn-block' onClick={deliverHandler}>Mark as Delivered</Button>\r\n                     </ListGroupItem>\r\n                   )}             \r\n                </ListGroup>\r\n              </Card>\r\n            </Col>\r\n          </Row>\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default OrderScreen;\r\n"]},"metadata":{},"sourceType":"module"}